import { Injectable} from '@angular/core';
import { Observable } from 'rxjs/Observable';
import { Subject } from 'rxjs/Subject';
import {Song} from './song';
import {BehaviorSubject} from 'rxjs/BehaviorSubject';

import {List} from 'immutable';

@Injectable()
export class SongService {

  constructor() {
    this.loadInitialData();
  }

  private _selectedSong = new BehaviorSubject<Song>(null);
  private _songs: BehaviorSubject<List<Song>> = new BehaviorSubject(List([]));

  public readonly selectedSong: Observable<Song> = this._selectedSong.asObservable();
  public readonly songs: Observable<List<Song>> = this._songs.asObservable();

  public setSelectedSong(song: Song) {
    this._selectedSong.next(song);
  }

  public addSong(song: Song) {
    this._songs.next(this._songs.getValue().push(song));
  }

  public firstSong():Song {
    return this._songs.getValue().first();
  }

  private loadInitialData() {

    const fur_elise = {
      'id': 1, 'title': 'FÃ¼r Elise', 'bartime': 3000,
      'tabulature': `
                                                                                  
E||------0---|--0---0-------|--------------|--------------|----------0---|
B||--------4-|----4---0-3-1-|--------------|--0---------0-|--1---------4-|
G||----------|--------------|--2---2-----2-|------1---1---|------2-------|
D||----------|--------------|----2-----2---|----2---2-----|----2---2-----|
A||----------|--------------|--0-----3-----|--------------|--0-----------|
E||----------|--------------|--------------|--0-----------|--------------|
                                                                          
--0---0-------|--------------|--------------|---------0---|--0---0-------|
----4---0-3-1-|--------------|--0-------1-0-|-----------4-|----4---0-3-1-|
--------------|--2---2-----2-|------1-------|--2---2------|--------------|
--------------|----2-----2---|----2---2-----|----2--------|--------------|
--------------|--0-----3-----|--------------|--0----------|--------------|
--------------|--------------|--0-----------|-------------|--------------|
                                                                           
--------------|--------------|----------0---|--0---0-------|--------------|
--------------|--0---------0-|--1---------4-|----4---0-3-1-|--------------|
--2---2-----2-|------1---1---|------2-------|--------------|--2---2-----2-|
----2-----2---|----2---2-----|----2---2-----|--------------|----2-----2---|
--0-----3-----|--------------|--0-----------|--------------|--0-----3-----|
--------------|--0-----------|--------------|--------------|--------------|
                                                                           
--------------|--------------|--0-------1-0-|----------0---|--------------|
--0-------1-0-|--------0-1-3-|------1-------|--3---0-----3-|--1-------3-1-|
------1-------|--2---2-------|--------0-----|----0---------|------2-------|
----2---0-----|----2---------|----2---------|--------3-----|----2---2-----|
--------------|--0-----------|--3-----------|--------------|--0-----------|
--0-----------|--------------|--------------|--3-----------|--------------|
                                                                            
------0---0---|--0---12---0---|--0---0---0---|--0---0-------|--------------|
--0-----------|---------4---4-|----4---4---4-|----4---0-3-1-|--------------|
--------------|----9----------|--------------|--------------|--2---2-----2-|
----2---2---2-|---------------|--------------|--------------|----2-----2---|
--------------|---------------|--------------|--------------|--0-----3-----|
--0-----------|---------------|--------------|--------------|--------------|
                                                                           
--------------|----------0---|--0---0-------|--------------|--------------|
--0---------0-|--1---------4-|----4---0-3-1-|--------------|--0-------1-0-|
------1---1---|------2-------|--------------|--2---2-----2-|------1-------|
----2---2-----|----2---2-----|--------------|----2-----2---|----2---0-----|
--------------|--0-----------|--------------|--0-----3-----|--------------|
--0-----------|--------------|--------------|--------------|--0-----------|
                                                                           
--------------|--0-------1-0-|----------0---|--------------|------0---0---|
--------0-1-3-|------1-------|--3---0-----3-|--1-------3-1-|--0-----------|
--2---2-------|--------0-----|----0---------|------2-------|--------------|
----2---------|----2---------|--------3-----|----2---2-----|----2---2---2-|
--0-----------|--3-----------|--------------|--0-----------|--------------|
--------------|--------------|--3-----------|--------------|--0-----------|
                                                                            
--0---12---0---|--0---0---0---|--0---0-------|--------------|--------------|
---------4---4-|----4---4---4-|----4---0-3-1-|--------------|--0---------0-|
---------------|--------------|--------------|--2---2-----2-|------1---1---|
---------------|--------------|--------------|----2-----2---|----2---2-----|
---------------|--------------|--------------|--0-----3-----|--------------|
----0----------|--------------|--------------|--------------|--0-----------|
                                                                           
----------0---|--0---0-------|--------------|--------------|--------------|
--1---------4-|----4---0-3-1-|--------------|--0-------1-0-|--------1-1-1-|
------2-------|--------------|--2---2-----2-|------1-------|--2---2-----3-|
----2---2-----|--------------|----2-----2---|----2---0-----|----2---2-3-2-|
--0-----------|--------------|--0-----3-----|--------------|--0-----1-0---|
--------------|--------------|--------------|--0-----------|------------3-|
                                                                    
----------1---0-|----------6---5-|--5/3-1-0-----|------------------|
--1-------1-----|--5---3---3-----|----------3-1-|------------------|
--2-2---2---2---|----3---3---3---|--------------|--3---2---2-0-2-3-|
------3---------|--3-------------|--3/2-0-2-3-2-|--3---------------|
----------------|----------------|--------------|----3-3h0---------|
--1-------------|----------------|--------------|------------------|
                                                                          
--------------|--0-----0-1---|----------------|----3---3---3---3---3---3-|
--1-------3-4-|------1-------|--1-------3---0-|--1-----------0---1---3---|
--2-2---2-----|----2---2---2-|----------------|------0---2---------------|
--3---3-------|--2-------0-3-|----2---3---3---|--------------3---2---0---|
--------------|--------------|----------------|--3-----------------------|
--------------|--------------|--3---3---3-----|--------------------------|
                                                      
--0-3-8h7-5h3-1-0---3-1---|----3---3---3---3---3---3-|
------------------3-----3-|--1-----------0---1---3---|
------------------0-------|------0---2---------------|
----------3---------------|--------------3---2---0---|
--3/--7-------------------|--3-----------------------|
--------------------------|--------------------------|
                                                                                
--0-3-8h7-5h3-1-0---3-1---|--0-1-0---0---0---0---0---|--0-----0---|--0-----0---|
------------------3-----3-|--------4---0---4---0---4-|------0---4-|------0---4-|
------------------0-------|--1-----------------------|------------|------------|
----------3---------------|--------------------------|------------|------------|
--3/--7-------------------|--------------------------|------------|------------|
--------------------------|--------------------------|------------|------------|
                                                                           
--0---0---0---|--0---0-------|--------------|--------------|----------0---|
----4---4---4-|----4---0-3-1-|--------------|--0---------0-|--1---------4-|
--------------|--------------|--2---2-----2-|------1---1---|------2-------|
--------------|--------------|----2-----2---|----2---2-----|----2---2-----|
--------------|--------------|--0-----3-----|--------------|--0-----------|
--------------|--------------|--------------|--0-----------|--------------|
                                                                           
--0---0-------|--------------|--------------|--------------|--0-------1-0-|
----4---0-3-1-|--------------|--0-------1-0-|--------0-1-3-|------1-------|
--------------|--2---2-----2-|------1-------|--2---2-------|--------0-----|
--------------|----2-----2---|----2---0-----|----2---------|----2---------|
--------------|--0-----3-----|--------------|--0-----------|--3-----------|
--------------|--------------|--0-----------|--------------|--------------|
                                                                            
----------0---|--------------|------0---0---|--0---12---0---|--0---0---0---|
--3---0-----3-|--1-------3-1-|--0-----------|---------4---4-|----4---4---4-|
----0---------|------2-------|--------------|---------------|--------------|
--------3-----|----2---2-----|----2---2---2-|---------------|--------------|
--------------|--0-----------|--------------|---------------|--------------|
--3-----------|--------------|--0-----------|----0----------|--------------|
                                                                           
--0---0-------|--------------|--------------|----------0---|--0---0-------|
----4---0-3-1-|--------------|--0---------0-|--1---------4-|----4---0-3-1-|
--------------|--2---2-----2-|------1---1---|------2-------|--------------|
--------------|----2-----2---|----2---2-----|----2---2-----|--------------|
--------------|--0-----3-----|--------------|--0-----------|--------------|
--------------|--------------|--0-----------|--------------|--------------|
                                                                           
--------------|--------------|--------------|--------------|----------0-1-|
--------------|--0-------1-0-|--------------|--2-----------|--3-------2-3-|
--2---2-----2-|------1-------|--2-----------|--3-----------|--2-----------|
----2-----2---|----2---0-----|--------------|--5-----------|--3-----------|
--0-----3-----|--------------|--0-0-0-0-0-0-|--0-0-0-0-0-0-|--0-0-0-0-0-0-|
--------------|--0-----------|--------------|--------------|--------------|
                                                                    
--1-------1---|--0-----------|-----------|----------|--------------|
--3-------3---|--1-----------|--3----1-0-|----------|------1---0---|
--1-------1---|--2-----------|-----------|--2----2--|--2-------1---|
--------------|--------------|--3----2-0-|--4-------|------2-------|
--0-0-0-0-0-0-|--0-0-0-0-0-0-|--0--------|--3----3--|--3-----------|
--------------|--------------|-----------|--5-------|--0-0-0-0-0-0-|
                                                                           
--------------|--------------|----------0-1-|--1-------1---|--1-----------|
--------------|--2-----------|--3-------2-3-|--3-------3---|--3-----------|
--2-----------|--3-----------|--2-----------|--------------|--------------|
--------------|--5-----------|--3-----------|--------------|--------------|
--3h0-0-0-0-0-|--0-0-0-0-0-0-|--0-0-0-0-0-0-|--0-0-0-0-0-0-|--1-1-1-1-1-1-|
--------------|--------------|--------------|--------------|--------------|
                                                                 
--------------|--------------|--------------|---------|---------|
--4-------3-1-|--------------|--------------|---------|--0------|
--0-----------|--3-------2---|--1-------1---|--2------|--1------|
----------3---|--0-------3---|--3-------3---|--2------|--2------|
--1-1-1-1-1-1-|--1-1-1-1-1-1-|--2-2-2-2-2-2-|--3------|---------|
--------------|--------------|--------------|---------|--0------|
                                                                       
------------0-------|------0----8-12-10h8----|------0----8-12-10h8----|
----------1---3h1-0-|----1---10-----------12-|----1---10-----------12-|
--------2-----------|--2---------------------|--2---------------------|
------2-------------|------------------------|------------------------|
--0h3---------0-----|--0-------------0-------|--0-------------0-------|
--------------------|------------------------|------------------------|
                                                                            
------------------------|--------------------|------0-------|--------------|
--11-10-9-8-----------3-|--2-1-0-------------|----4---0-3-1-|--------------|
------------11-10-9-8---|--------3-2-1-0-----|--------------|--2---2-----2-|
------------------------|----------------4-3-|--2-----------|----2-----2---|
--0---------------------|--------------------|--------------|--0-----3-----|
------------------------|--------------------|--------------|--------------|
                                                                           
--------------|----------0---|--0---0-------|--------------|--------------|
--0---------0-|--1---------4-|----4---0-3-1-|--------------|--0-------1-0-|
------1---1---|------2-------|--------------|--2---2-----2-|------1-------|
----2---2-----|----2---2-----|--------------|----2-----2---|----2---0-----|
--------------|--0-----------|--------------|--0-----3-----|--------------|
--0-----------|--------------|--------------|--------------|--0-----------|
                                                                           
--------------|--0-------1-0-|----------0---|--------------|------0---0---|
--------0-1-3-|------1-------|--3---0-----3-|--1-------3-1-|--0-----------|
--2---2-------|--------0-----|----0---------|------2-------|--------------|
----2---------|----2---------|--------3-----|----2---2-----|----2---2---2-|
--0-----------|--3-----------|--------------|--0-----------|--------------|
--------------|--------------|--3-----------|--------------|--0-----------|
                                                                            
--0---12---0---|--0---0---0---|--0---0-------|--------------|--------------|
---------4---4-|----4---4---4-|----4---0-3-1-|--------------|--0---------0-|
----9----------|--------------|--------------|--2---2-----2-|------1---1---|
---------------|--------------|--------------|----2-----2---|----2---2-----|
---------------|--------------|--------------|--0-----3-----|--------------|
---------------|--------------|--------------|--------------|--0-----------|
                                                                       
----------0---|--0---0-------|--------------|--------------|---------||
--1---------4-|----4---0-3-1-|--------------|--0-------1-0-|---------||
------2-------|--------------|--2---2-----2-|------1-------|--2------||
----2---2-----|--------------|----2-----2---|----2---0-----|---------||
--0-----------|--------------|--0-----3-----|--------------|--0------||
--------------|--------------|--------------|--0-----------|---------||

`
    };


    const ode_to_joy = {
      'id': 2, 'title': 'Ode to Joy', 'bartime': 123,
      'tabulature': 'xyz'
    };

    this.addSong(fur_elise);
    this.addSong(ode_to_joy);

    this.setSelectedSong(ode_to_joy);

  }

}
